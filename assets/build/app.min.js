/*! cloak-of-darkness 2015-10-30 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var _createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_get=function(a,b,c){for(var d=!0;d;){var e=a,f=b,g=c;d=!1,null===e&&(e=Function.prototype);var h=Object.getOwnPropertyDescriptor(e,f);if(void 0!==h){if("value"in h)return h.value;var i=h.get;return void 0===i?void 0:i.call(g)}var j=Object.getPrototypeOf(e);if(null===j)return void 0;a=j,b=f,c=g,d=!0,h=j=void 0}},CloakOfDarkness=function(){function a(){var a=[];for(var b in d)d.hasOwnProperty(b)&&(a=a.concat(d[b]));return a}var b="Cloak of Darkness",c={Enter:13,Up:38,Down:40},d={north:["north","n"],northEast:["northeast","ne"],northWest:["northwest","nw"],south:["south","s"],southEast:["southeast","se"],southWest:["southwest","sw"],east:["east","e"],west:["west","w"]},e=[{id:0,name:"Opera House Foyer",entryText:"You are in the Foyer of the Opera House. This room has doors to the south and west, also an unusable exit to the north. The room is quiet and you don't see anyone around.",objects:[],triggers:[],actions:[],adjacentRooms:[{direction:d.west,roomId:1},{direction:d.south,roomId:2}]},{id:1,name:"Cloak Room",entryText:"You are in the cloak room and you can see a hook on the wall.",objects:[],triggers:[],actions:[{name:"hang",synonyms:["hang","place","put"],func:function(a,b,c,d){"cloak"===d[0]&&(a.inventory=_.remove(a.inventory,function(a){return"cloak"!==a.name}),b.say("You take off your cloak and hang it up on the hook."))}}],adjacentRooms:[{direction:d.east,roomId:0}]},{id:2,name:"Bar",entryText:"",objects:[],triggers:[{name:"entry",func:function(a,b){var c=_.find(a.inventory,function(a){return"cloak"===a.name});void 0===c&&void 0===a.won?(b.say("The room is lit vibrantly and you notice a message is scratched in sawdust on the floor.",!0),a.won=!0):a.won===!1?b.say("You can see the room now and there is nothing special about it. You do notice that there is a mess on the floor but you cannot discern why it's there."):b.say("You are in the bar and it is extremely dark, you cannot see anything right now. You can't even see if there is a light switch.",!0)}},{name:"movement",func:function(a,b){var c=_.find(a.inventory,function(a){return"cloak"===a.name});void 0!==c&&(a.won=!1,b.say("Your movement has disturbed things within the room and the room is no longer as it was when you first entered.",!0))}.bind(this)}],actions:[{name:"message",synonyms:["read"],func:function(a,b,c,d){var e=_.find(a.inventory,function(a){return"cloak"===a.name});"message"===d[0]&&(void 0===e&&void 0!==a.won&&a.won?b.say("The message on the floor reads, YOU WON!"):void 0===a.won||a.won?b.say("You cannot see anything in the room because it's too dark."):b.say("Because you disturbed the room while moving around in the dark you made the message written on the floor impossible to read. I'm sorry but you have lost."))}}],adjacentRooms:[{direction:d.north,roomId:0}]}],f=[{name:"cloak",description:"A eerily dark velvet cloak",synonyms:["cloak","dark cloak","velvet cloak"],examine:function(a,b,c){b.say(this.description,!0)},type:{name:"garment",worn:!0,description:"This garment is made of a light absorbing material causing it to cancels available light shedding darkness on objects around you."}}],g=[_.find(f,{name:"cloak"})],h=function(a){function b(){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).call(this),this.onCommandInputKeyUp=this.onCommandInputKeyUp.bind(this),this.state={commandIndex:-1,commandsEntered:[]}}return _inherits(b,a),_createClass(b,[{key:"componentDidMount",value:function(){var a=$("#commandText");this.setState({commandText:a}),a.width(window.innerWidth-50),$(window).resize(function(b){a.width(window.innerWidth-50)})}},{key:"onCommandInputKeyUp",value:function(a){var b=this;if(a.which===c.Up){var d=-1===this.state.commandIndex?this.state.commandsEntered.length-1:--this.state.commandIndex;0>d&&(d=0),this.setState({commandIndex:d},function(){this.state.commandText.val(this.state.commandsEntered[d])})}else if(a.which===c.Down){var d=-1===this.state.commandIndex?0:++this.state.commandIndex;d>this.state.commandsEntered.length&&(d=this.state.commandsEntered.length),this.setState({commandIndex:d},function(){this.state.commandText.val(this.state.commandsEntered[d])})}else if(a.which===c.Enter){var e=function(){var a=b.state.commandText.val();return a.length>0?(b.state.commandText.val(""),void b.setState({commandsEntered:_.uniq(b.state.commandsEntered.concat([a])),commandIndex:-1},function(){void 0!==this.props.onKeyEnter&&this.props.onKeyEnter(a)})):{v:void 0}}();if("object"==typeof e)return e.v}}},{key:"render",value:function(){var a={paddingLeft:"10px"},b={border:"none",outline:"none",paddingLeft:"2px"};return React.createElement("div",{id:"commandContainer",style:a},">",React.createElement("input",{id:"commandText",style:b,type:"text",onKeyUp:this.onCommandInputKeyUp}))}}]),b}(React.Component),i=function(a){function b(){_classCallCheck(this,b),_get(Object.getPrototypeOf(b.prototype),"constructor",this).apply(this,arguments)}return _inherits(b,a),_createClass(b,[{key:"render",value:function(){var a={backgroundColor:"#000",position:"fixed",top:"0",width:"100%",paddingLeft:"10px"},b={backgroundColor:"#000",color:"#fff",marginBottom:"25px"},c={backgroundColor:"#000",color:"#fff"},d={backgroundColor:"#000",color:"#fff",right:"20px",position:"absolute"},e="";return void 0!==this.props.title&&this.props.title.length>0&&void 0!==this.props.room&&this.props.room.length>0&&(e=" | "),React.createElement("div",{id:"info",style:a},React.createElement("span",{id:"title",style:b},this.props.title," ",e),React.createElement("span",{id:"room",style:c},this.props.room),React.createElement("span",{id:"score",style:d},this.props.score))}}]),b}(React.Component),j=function(c){function d(){_classCallCheck(this,d),_get(Object.getPrototypeOf(d.prototype),"constructor",this).call(this),this.onCommandEntered=this.onCommandEntered.bind(this);var b=[{synonyms:["exits","ex"],func:function(a,b,c,d){var e=[];_.forEach(_.pluck(a.room.adjacentRooms,"direction"),function(a){e.push(_.first(a))}),e.length>0&&this.say("the following exits are available: "+e.join(", "),!0)}.bind(this)},{synonyms:["inventory","i"],func:function(a,b,c,d){a.inventory.length>0?_.forEach(a.inventory,function(a){var b="";"garment"===a.type.name?(b=a.type.worn?"is":"is not",this.say(a.name+" (which "+b+" being worn)",!0)):this.say(a.name)}.bind(this)):this.say("Your inventory contains no items.<br/>")}.bind(this)},{synonyms:["look","l"],func:function(a,b,c,d){a.room!=={}&&a.room.entryText.length>0&&this.say(a.room.entryText,!0)}.bind(this)},{synonyms:["examine","x"],func:function(a,b,c,d){if(d.length>0){var e=_.find(a.inventory,function(a){return a.name===d[0]});void 0!==e?e.examine(a,b,d):this.say("I cannot examine that object.")}}.bind(this)},{synonyms:a(),func:function(a,b,c,d){this.go(c)}.bind(this)}],c=[{synonyms:["/clear"],func:function(a,b){this.clear()}.bind(this)},{synonyms:["/restart"],func:function(a,b){this.clear(),this.startGame()}.bind(this)},{synonyms:["help","h"],func:function(a,b){var c=["<b>/clear</b> - clears the screen","<b>/restart</b> - restarts the game","<b>h, help</b> - prints this message","<b>i, inventory</b> - prints your inventory","<b>l, look</b> - prints the description of the current room","<b>x, examine</b> - prints a detailed description of an object","<b>ex, exits</b> - prints the list of exits for this room","<b>n, north, ne, northeast, nw, northwest, s, south, se, southeast, sw, southwest, e, east, w, west</b> - moves the player to a room relative to the direction specified"];this.say("<blockquote>"+c.join("<br/>")+"</blockquote>")}.bind(this)}];this.state={rooms:e,objects:[],playerCommands:b,systemCommands:c,player:{room:{name:""},score:""}}}return _inherits(d,c),_createClass(d,[{key:"initializePlayer",value:function(){return{score:"",room:{},inventory:g}}},{key:"scrollContentArea",value:function(){$("html, body").animate({scrollTop:$(document).height()},1e3)}},{key:"clear",value:function(){this.state.content.html("")}},{key:"printCommand",value:function(a){this.state.content.append("<h3>&gt;"+a+"</h3>")}},{key:"say",value:function(a,b){if(a.length>0){var c="";b&&(c="<p/>"),this.state.content.append(a+c),this.scrollContentArea()}}},{key:"startGame",value:function(){var a=_.findWhere(e,{id:0});if(void 0!==a){var b=this.initializePlayer();b.room=a,this.setState({player:b},function(){this.say(b.room.entryText,!0)}.bind(this))}}},{key:"getCommand",value:function(a,b){var c={},d=function(b,d,e){c!=={}&&_.forEach(b,function(b){return _.indexOf(b.synonyms,a)>-1?(e({commandType:d,command:b}),!1):void 0})},b=function(a){c=a};return d(this.state.playerCommands,"player",b),d(this.state.player.room.actions,"player",b),d(this.state.systemCommands,"system",b),c}},{key:"findAndExecuteTrigger",value:function(a){if(void 0!==this.state.player.room.triggers&&this.state.player.room.triggers.length>0){var b=_.find(this.state.player.room.triggers,function(b){return b.name===a});void 0!==b&&b.func(this.state.player,this)}}},{key:"go",value:function(a){var b=_.filter(this.state.player.room.adjacentRooms,function(b){return _.indexOf(b.direction,a)>-1});if(b.length>0){var c=_.find(this.state.rooms,{id:b[0].roomId});void 0!==c&&(this.say("entered: "+c.name,!0),this.state.player.room=c,this.forceUpdate(),""!==this.state.player.room.entryText&&this.say(this.state.player.room.entryText,!0),this.findAndExecuteTrigger("entry"))}else this.say("You cannot go in that direction.",!0),this.findAndExecuteTrigger("movement")}},{key:"onCommandEntered",value:function(a){this.printCommand(a);var b=a.split(" "),c=b[0],d=b.slice(1),e=this.getCommand(c);void 0!==e.commandType&&("player"===e.commandType?e.command.func(this.state.player,this,c,d):"system"===e.commandType&&e.command.func(c,d)),this.scrollContentArea()}},{key:"componentDidMount",value:function(){this.setState({content:$("#content"),player:this.initializePlayer()},function(){this.startGame()})}},{key:"render",value:function(){var a={marginTop:"50px",padding:"10px"};return React.createElement("div",null,React.createElement(i,{title:b,room:this.state.player.room.name,score:this.state.player.score}),React.createElement("div",{id:"content",style:a}),React.createElement(h,{onKeyEnter:this.onCommandEntered}))}}]),d}(React.Component);return{init:function(){ReactDOM.render(React.createElement(j,null),document.getElementById("ui"))}}}();$(document).ready(function(){CloakOfDarkness.init()});